# å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ¯ 5åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
cd backend
pip install -r requirements.txt
```

### æ­¥éª¤ 2: é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼ˆæœ€å°‘éœ€è¦é…ç½® ComfyUIï¼‰
# COMFYUI_URL=http://127.0.0.1:8188
```

### æ­¥éª¤ 3: é…ç½® ComfyUI å·¥ä½œæµ

ç¼–è¾‘ `comfyui_workflow_template.py`:

```python
COMFYUI_WORKFLOW = {
    # ç²˜è´´ä» ComfyUI å¯¼å‡ºçš„å·¥ä½œæµ JSON
}

DYNAMIC_NODES = {
    "positive_prompt_node": "6",
    "negative_prompt_node": "7",
    "save_image_node": "9",
    "seed_node": "3",
    "size_node": "5",
}
```

### æ­¥éª¤ 4: å¯åŠ¨ ComfyUI

```bash
cd ComfyUI
python main.py
```

### æ­¥éª¤ 5: æµ‹è¯• ComfyUI è¿æ¥

```bash
cd backend
python test_comfyui_connection.py
```

### æ­¥éª¤ 6: å¯åŠ¨ Agent ç³»ç»Ÿ

```bash
python start_agent_system.py
```

### æ­¥éª¤ 7: æµ‹è¯• API

```bash
curl -X POST http://localhost:8000/api/agent/create-video \
  -H "Content-Type: application/json" \
  -d '{
    "keywords": ["AI", "ç§‘æŠ€"],
    "style": "cinematic",
    "duration": 60
  }'
```

---

## ğŸ“‹ é…ç½®ä¼˜å…ˆçº§

### å¿…é¡»é…ç½® â­

1. **ComfyUI**
   ```bash
   COMFYUI_URL=http://127.0.0.1:8188
   ```
   - åœ¨ `comfyui_workflow_template.py` ä¸­é…ç½®å·¥ä½œæµ

### æ¨èé…ç½® â­â­

2. **å¤§æ¨¡å‹ API**ï¼ˆç”¨äºè„šæœ¬ç”Ÿæˆï¼‰
   ```bash
   LLM_API_KEY=your_openai_api_key
   LLM_API_ENDPOINT=https://api.openai.com/v1/chat/completions
   LLM_MODEL=gpt-4
   ```
   - å¦‚æœä¸é…ç½®ï¼Œä¼šä½¿ç”¨æ¨¡æ¿ç”Ÿæˆè„šæœ¬

### å¯é€‰é…ç½® â­â­â­

3. **æŠ–éŸ³ API**ï¼ˆç”¨äºçƒ­ç‚¹é‡‡é›†ï¼‰
   ```bash
   DOUYIN_API_KEY=your_api_key
   DOUYIN_API_SECRET=your_api_secret
   ```
   - å¦‚æœä¸é…ç½®ï¼Œä¼šä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®

4. **å›¾åƒæœç´¢ API**ï¼ˆç”¨äºå‚è€ƒå›¾ï¼‰
   ```bash
   IMAGE_SEARCH_API_KEY=your_unsplash_api_key
   IMAGE_SEARCH_API_ENDPOINT=https://api.unsplash.com/search/photos
   ```
   - å¦‚æœä¸é…ç½®ï¼Œä¼šä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®

5. **å›¾åƒåˆ†æ API**ï¼ˆç”¨äºä¸€è‡´æ€§æ£€éªŒï¼‰
   ```bash
   VISION_API_KEY=your_vision_api_key
   FACE_API_KEY=your_face_api_key
   QUALITY_API_KEY=your_quality_api_key
   ```
   - å¦‚æœä¸é…ç½®ï¼Œä¼šä½¿ç”¨å¯å‘å¼æ–¹æ³•

---

## ğŸ¬ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: æœ€ç®€å•çš„è°ƒç”¨

```bash
curl -X POST http://localhost:8000/api/agent/create-video \
  -H "Content-Type: application/json" \
  -d '{
    "duration": 30
  }'
```

### ç¤ºä¾‹ 2: æŒ‡å®šå…³é”®è¯å’Œé£æ ¼

```bash
curl -X POST http://localhost:8000/api/agent/create-video \
  -H "Content-Type: application/json" \
  -d '{
    "keywords": ["äººå·¥æ™ºèƒ½", "ç§‘æŠ€"],
    "style": "cinematic",
    "duration": 60
  }'
```

### ç¤ºä¾‹ 3: å®Œæ•´é…ç½®

```bash
curl -X POST http://localhost:8000/api/agent/create-video \
  -H "Content-Type: application/json" \
  -d '{
    "keywords": ["AI", "ç§‘æŠ€"],
    "style": "cinematic",
    "duration": 60,
    "comfyui_workflow": {
      "width": 1024,
      "height": 576,
      "steps": 30,
      "cfg_scale": 7.5
    },
    "batch_size": 2,
    "output_filename": "my_video.mp4"
  }'
```

### ç¤ºä¾‹ 4: Python ä»£ç è°ƒç”¨

```python
import asyncio
from app.agents.orchestrator import VideoCreationOrchestrator

async def main():
    orchestrator = VideoCreationOrchestrator()
    
    result = await orchestrator.create_video({
        'keywords': ['AI', 'ç§‘æŠ€'],
        'style': 'cinematic',
        'duration': 60
    })
    
    if result['success']:
        print(f"è§†é¢‘ç”ŸæˆæˆåŠŸ: {result['final_video']}")
    else:
        print(f"ç”Ÿæˆå¤±è´¥: {result['error']}")

asyncio.run(main())
```

---

## ğŸ” æŸ¥çœ‹ç»“æœ

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/agent_system.log

# æŸ¥çœ‹é”™è¯¯
grep ERROR logs/agent_system.log
```

### æŸ¥çœ‹ç”Ÿæˆçš„è§†é¢‘

```bash
ls -lh output/videos/
```

### æŸ¥çœ‹ API å“åº”

API ä¼šè¿”å›è¯¦ç»†çš„æ‰§è¡Œç»“æœï¼š

```json
{
  "success": true,
  "stages": {
    "hotspot": {
      "selected_hotspot": {...}
    },
    "script": {
      "scenes": [...]
    },
    "storyboard": {
      "shots": [...]
    },
    "generation": {
      "generated_images": [...]
    },
    "consistency": {
      "pass_rate": 0.875
    },
    "synthesis": {
      "video_path": "output/videos/final_video.mp4"
    }
  },
  "final_video": "output/videos/final_video.mp4"
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ComfyUI è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ ComfyUI æ˜¯å¦è¿è¡Œ
curl http://127.0.0.1:8188/system_stats

# å¦‚æœå¤±è´¥ï¼Œå¯åŠ¨ ComfyUI
cd ComfyUI
python main.py
```

### Q2: å·¥ä½œæµæœªé…ç½®

```
é”™è¯¯: ComfyUI å·¥ä½œæµæœªé…ç½®
```

**è§£å†³**: åœ¨ `comfyui_workflow_template.py` ä¸­å¡«å…… `COMFYUI_WORKFLOW`

### Q3: å›¾åƒç”Ÿæˆè¶…æ—¶

```
é”™è¯¯: ä»»åŠ¡ç”Ÿæˆè¶…æ—¶
```

**è§£å†³**:
- å‡å°‘é‡‡æ ·æ­¥æ•°: `"steps": 20`
- é™ä½åˆ†è¾¨ç‡: `"width": 512, "height": 512`
- å¢åŠ è¶…æ—¶: `TIMEOUT=600` (åœ¨ .env ä¸­)

### Q4: è§†é¢‘åˆæˆå¤±è´¥

```
é”™è¯¯: è§†é¢‘åˆæˆå¤±è´¥
```

**è§£å†³**:
- æ£€æŸ¥æ˜¯å¦å®‰è£…äº† ffmpeg: `ffmpeg -version`
- æ£€æŸ¥å›¾åƒ URL æ˜¯å¦å¯è®¿é—®
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—: `tail -f logs/agent_system.log`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ç³»ç»Ÿå®Œæ•´è¯´æ˜æ–‡æ¡£.md** - è¯¦ç»†çš„ç³»ç»Ÿè¯´æ˜
- **ç³»ç»ŸåŠŸèƒ½æ€»ç»“.md** - åŠŸèƒ½æ€»ç»“
- **åŠŸèƒ½å®ç°æ€»ç»“.md** - å®ç°ç»†èŠ‚
- **å¦‚ä½•è°ƒç”¨ComfyUIå·¥ä½œæµ.md** - ComfyUI è¯¦ç»†è¯´æ˜
- **ComfyUIé›†æˆæ­¥éª¤.md** - ComfyUI å¿«é€Ÿå¼€å§‹

---

## ğŸ‰ å¼€å§‹åˆ›ä½œ

ç°åœ¨ä½ å¯ä»¥å¼€å§‹åˆ›ä½œè§†é¢‘äº†ï¼

```bash
# åˆ›å»ºä¸€ä¸ªå…³äº AI çš„è§†é¢‘
curl -X POST http://localhost:8000/api/agent/create-video \
  -H "Content-Type: application/json" \
  -d '{"keywords": ["AI"], "duration": 60}'
```

ç”Ÿæˆçš„è§†é¢‘å°†ä¿å­˜åœ¨ `output/videos/` ç›®å½•ä¸­ã€‚

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
